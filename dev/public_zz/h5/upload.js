!function(a){a.fn.html5Uploader=function(b){function c(a){var b=a.size,c=b/1024;if(c>5e3)return alert("附件不能大于5M"),!1;var h=new FileReader;h.onabort=function(b){g.onClientAbort&&g.onClientAbort(b,a)},h.onerror=function(b){g.onClientError&&g.onClientError(b,a)},h.onload=function(b){g.onClientLoad&&g.onClientLoad(b,a)},h.onloadend=function(b){g.onClientLoadEnd&&g.onClientLoadEnd(b,a)},h.onloadstart=function(b){g.onClientLoadStart&&g.onClientLoadStart(b,a)},h.onprogress=function(b){g.onClientProgress&&g.onClientProgress(b,a)},h.readAsDataURL(a);var i=new XMLHttpRequest;if(i.upload.onabort=function(b){g.onServerAbort&&g.onServerAbort(b,a)},i.upload.onerror=function(b){g.onServerError&&g.onServerError(b,a)},i.upload.onload=function(b){g.onServerLoad&&g.onServerLoad(b,a)},i.upload.onloadstart=function(b){g.onServerLoadStart&&g.onServerLoadStart(b,a)},i.upload.onprogress=function(b){g.onServerProgress&&g.onServerProgress(b,a)},i.onreadystatechange=function(b){g.onServerReadyStateChange&&g.onServerReadyStateChange(b,a,i.readyState),g.onSuccess&&4==i.readyState&&200==i.status&&g.onSuccess(b,a,i.responseText)},i.open("POST",g.postUrl,!0),a.getAsBinary){var j=f+e+d+'Content-Disposition: form-data;name="'+g.name+'";filename="'+unescape(encodeURIComponent(a.name))+'"'+d+"Content-Type: application/octet-stream"+d+d+a.getAsBinary()+d+f+e+f;i.setRequestHeader("Content-Type","multipart/form-data;boundary="+e),i.sendAsBinary(j)}else if(window.FormData){var k=new FormData;k.append(g.name,a),i.send(k)}}var d="\r\n",e="iloveigloo",f="--",g={name:"uploadedFile",postUrl:"Upload.php",onClientAbort:null,onClientError:null,onClientLoad:null,onClientLoadEnd:null,onClientLoadStart:null,onClientProgress:null,onServerAbort:null,onServerError:null,onServerLoad:null,onServerLoadStart:null,onServerProgress:null,onServerReadyStateChange:null,onSuccess:null};return b&&a.extend(g,b),this.each(function(){var b=a(this);b.is("[type='file']")?b.bind("change",function(){for(var a=this.files,b=0;b<a.length;b++)c(a[b])}):b.bind("dragenter dragover",function(){return a(this).addClass("hover"),!1}).bind("dragleave",function(){return a(this).removeClass("hover"),!1}).bind("drop",function(b){a(this).removeClass("hover");for(var d=b.originalEvent.dataTransfer.files,e=0;e<d.length;e++)c(d[e]);return!1})})}}(Zepto);