function load(){$(".page").hide(),$(".footer-nav.box-flex a").removeClass("curr"),page=_hash(),$("#page-"+page).show(),$(".footer-nav.box-flex a[data='#"+page+"']").addClass("curr"),"message"==page?(pageFrom=0,$("#message-list").empty(),get_message_list(),$("#page-message .refresh-bar").unbind("click"),$("#page-message .refresh-bar").click(function(a){return $(this).hide(),pageFrom+=pageSize,get_message_list(),a.stopPropagation(),!1}),$("#page-message .box-flex .flex").unbind("click"),$("#page-message .box-flex .flex").click(function(a){return $("#message-list").empty(),$("#page-message .box-flex .flex").removeClass("curr"),$(this).addClass("curr"),pageFrom=0,get_message_list(),a.stopPropagation(),a.preventDefault(),!1})):"project"==page?$("#project_iframe").attr("src","/public/mobile/wanke/sell.html?userId="+userId):"customer"==page?($.get("/json.php/MiddleMan/AddDealRequest",{userId:userId},function(a){var a=parse(a);0!=a.retCode&&($("#addcustomer-submit").attr("disabled","disabled"),$(".add-customer").parent().css("background","#ccc"),$("#page-customer").css("background","none"),$(".add-customer").attr("disabled","disabled"),$(".add-customer").attr("href",null),$("#page-customer .add-customer").unbind("click"),$("#page-customer .add-customer").click(function(){alert(a.retMessage)}))}),$("input[type='tel']").val(""),pageFrom=0,$("#customer-list").empty(),get_customer_list(),$("#page-customer #search_phoneNumber").unbind("click"),$("#page-customer #search_phoneNumber").click(function(){$("#search_phoneNumber").css("text-align","left"),$("#search_phoneNumber").css("background","#fff"),$("#search_phoneNumber").parent().parent().css("height","110px"),$("#search_phoneNumber").parent().find("input[type='button']").show(),$("#search_phoneNumber").parent().find("label").show()}),$("#page-customer input[type='button']").click(function(){var a=$("#page-customer #search_phoneNumber").val();pageFrom=0,$("#customer-list").empty(),get_customer_list(a),$("#search_phoneNumber").css("text-align","center"),$("#search_phoneNumber").parent().parent().css("height","32px"),$("#search_phoneNumber").parent().css("padding-top","0px"),$("#search_phoneNumber").parent().find("input[type='button']").hide(),$("#search_phoneNumber").parent().find("label").hide()}),$("#page-customer #search").unbind("click"),$("#page-customer #search").click(function(a){var b=$("#page-customer #search_phoneNumber").val();return pageFrom=0,$("#customer-list").empty(),get_customer_list(b),a.stopPropagation(),!1}),$("#page-customer .refresh-bar").unbind("click"),$("#page-customer .refresh-bar").click(function(a){$(this).hide(),pageFrom+=pageSize;var b=$("#page-customer #search_phoneNumber").val();return get_customer_list(b),a.stopPropagation(),!1}),$("#page-customer .action.flex .btn").unbind("click"),$("#page-customer .action.flex .btn").click(function(a){return $("#customer-list").empty(),$("#page-customer .action.flex .btn").removeClass("active"),$(this).addClass("active"),pageFrom=0,get_customer_list(),a.stopPropagation(),!1})):"addcustomer"==page?($(".footer-nav.box-flex a[data='#customer']").addClass("curr"),$(".b-bak").click(function(a){return location.href="#customer",a.stopPropagation(),!1}),$.get("/json.php/MiddleMan/AddDealRequest",{userId:userId},function(a){$("#addcustomer-area").empty(),$("#addcustomer-budget").empty();var a=parse(a);if(0!=a.retCode)return alert(a.retMessage),void(location.href="#customer");var b=a.data.areaList,c=a.data.budgetList,d="<option value='NULL'>请选择面积</option>";$("#addcustomer-area").append(d);for(var e in b){var d="<option value='"+b[e]+"'>"+b[e]+"</option>";$("#addcustomer-area").append(d)}var d="<option value='NULL'>请选择预算</option>";$("#addcustomer-budget").append(d);for(var e in c){var d="<option value='"+c[e]+"'>"+c[e]+"</option>";$("#addcustomer-budget").append(d)}}),pageFrom=0,get_project_option(),$("#addcustomer-submit").unbind("click"),$("#addcustomer-submit").click(add_customer),$("#addcustomer-reset").click(reset_customer)):"user"==page?(pageFrom=0,get_user_info()):"detail"==page&&($(".footer-nav.box-flex a[data='#customer']").addClass("curr"),pageFrom=0,get_detail_info())}function get_project_list(){$.get("/json.php/MiddleMan/GetProjectList",{userId:userId,pageFrom:pageFrom,pageSize:pageSize},function(a){var a=parse(a);if(0!=a.retCode)return void alert(a.retMessage);var b=a.data;for(var c in b){var d=sprintf(project_feed,b[c].infoUrl,b[c].title,b[c].createTime,b[c].pictureUrl,b[c].description);$("#project-list").append(d)}pageFrom<a.count&&$("#page-project .refresh-bar").show()})}function get_message_list(){var a=$("#page-message .flex.curr").attr("data");$.get("/json.php/MiddleMan/GetMessageList",{userId:userId,type:a,pageFrom:pageFrom,pageSize:pageSize},function(a){var a=parse(a);if(0!=a.retCode)return void alert(a.retMessage);var b=a.data;for(var c in b){var d=sprintf(message_feed,b[c].createTime,b[c].message);$("#message-list").append(d)}pageFrom<a.count&&$("#page-message .refresh-bar").show()})}function get_customer_list(a){void 0==a&&(a=""),$.get("/json.php/MiddleMan/GetDealList",{userId:userId,pageFrom:pageFrom,pageSize:pageSize,phoneNumber:a},function(a){var a=parse(a);if(0!=a.retCode)return void alert(a.retMessage);var b=a.data;for(var c in b){var d=sprintf(customer_feed,b[c].dealId,b[c].name,b[c].phoneNumber,b[c].projectName,b[c].stateName,b[c].area,b[c].budget,b[c].price);$("#customer-list").append(d)}pageFrom<a.count&&$("#page-customer .refresh-bar").show()})}function get_project_option(){$.get("/json.php/MiddleMan/GetProjectList",{userId:userId},function(a){var a=parse(a);if(0!=a.retCode)return void alert(a.retMessage);$("#addcustomer-project").empty();var b=a.data,c="";for(var d in b)c+="<option value='"+b[d].projectId+"'>"+b[d].title+"</option>";$("#addcustomer-project").append(c)})}function addcustomer_success(a){var b=sprintf(addcustomer_feed,a.tips,a.beg_time,a.end_time);$("#addcustomer-result").html(b),$("#addcustomer-viewpage").show(),$("#addcustomer-addpage").hide()}function reset_customer(){$("#addcustomer-project").val("NULL"),$("#addcustomer-name").val(""),$("#addcustomer-phone").val(""),$("#addcustomer-area").val(""),$("#addcustomer-budget").val(""),$("#addcustomer-viewpage").hide(),$("#addcustomer-addpage").show()}function add_customer(){var a={};return a.userId=userId,a.name=$("#addcustomer-name").val(),a.projectId=$("#addcustomer-project").val(),a.project=$("#addcustomer-project").val(),a.projectName=$("select#addcustomer-project option[value='"+a.projectId+"']").text(),a.phoneNumber=$("#addcustomer-phone").val(),a.area=$("#addcustomer-area").val(),a.budget=$("#addcustomer-budget").val(),""==a.name?void alert("请输入客户名称"):"NULL"==a.projectId?void alert("请选择楼盘信息"):""==a.phoneNumber?void alert("请输入客户手机号码"):"NULL"==a.area?void alert("请选择面积"):"NULL"==a.budget?void alert("请选择预算"):($("#addcustomer-submit").attr("disabled","disabled"),void $.post("/json.php/MiddleMan/AddDeal",a,function(a){var a=parse(a);return 0!=a.retCode?(alert(a.retMessage),void(location.href="#customer")):(iosOverlay({text:"添加成功",duration:2e3,icon:"/public/mobile/img/check.png",onhide:function(){reset_customer(),location.href="#customer"}}),void $("#addcustomer-submit").attr("disabled",null))}))}function get_user_info(){$.get("/json.php/MiddleMan/GetDealAchievement",{userId:userId},function(a){var a=parse(a);return 0!=a.retCode?void alert(a.retMessage):(a=a.data,$("#report").text(a.ClientHaveReport),$("#look").text(a.ClientHaveLook),$("#pledge").text(a.ClientHavePledge),$("#deal").text(a.ClientHaveDeal),$("#payready").text(a.ClientPayReady),$("#havepay").text(a.RequestPay),void $("#chavepay").text(a.HavePay))})}function get_detail_info(){return dealId=$("#customer-list li.active").attr("data"),dealId&&""!=dealId?($.get("/json.php/MiddleMan/GetDealInfo",{userId:userId,dealId:dealId},function(a){var a=JSON.parse(a);if(0!=a.retCode)return void alert(a.retMessage);a=a.data,$("#contact_customer").attr("href","tel:"+a.phoneNumber),$("#detail-name").text(a.name),$("#detail-project").text(a.projectName),$("#detail-timeline").empty();var b=a.stateInfo,c="";for(var d in b){if(6==d){c+=sprintf(last_detail_feed,b[d].stateName,b[d].createTime);break}c+=sprintf(detail_feed,b[d].stateName,b[d].createTime)}$("#detail-timeline").append(c)}),$("#appeal #cancel_appeal").unbind("click"),$("#appeal #cancel_appeal").click(function(){$("#appeal .text-area").val(""),$("#appeal").hide()}),$("#appeal .btn").unbind("click"),$("#appeal .btn").click(function(){return""==$("#appeal .text-area").val()?void alert("请输入申诉内容"):($("#appeal .btn").unbind("click"),void $.post("/json.php/MiddleMan/AddDealAppeal",{userId:userId,dealId:dealId,message:$("#appeal .text-area").val()},function(){iosOverlay({text:"操作成功",duration:2e3,icon:"/public/mobile/img/check.png"}),$("#appeal").hide(),$("#appeal .text-area").val("")}))}),void $("#apply").click(function(){$("#appeal .text-area").val(""),$("#appeal").show(),$(".text-area").focus()})):void(location.href="#customer")}function click_customer_detail(a){$(a).addClass("active"),location.href="#detail",$("#sub_back").click(function(){return location.href="#customer",load(),!1})}var page="message",pageFrom=0,pageSize=10,userId=_get("userId"),dealId="";window.onhashchange=load;var project_feed='<div class="feed dataItem" onclick="location.href=\'%s\'"><div class="hd">	<p class="info ">	<span class="title">%s</span><span class="meta" style="float:right"><time class="time">%s</time></span>	</p></div><div class="bd">	<p class="img loaded">	<img style="max-width: 320px" src="%s" /></p>	<p class="description">%s</p></div></div>',message_feed="<li><time>%s</time><p>%s</p></li>",customer_feed='<li data="%s" onclick="click_customer_detail(this)"><div class="t"><h2>%s(%s)</h2>	<span class="meta">%s</span></div><p>%s</p><p><span>面积：%s</span><span>预算：%s</span><span>佣金：%s</span></p></li>',addcustomer_feed="<div >%s<br>可带看时间：%s<br>失效时间：%s</div>",detail_feed='<li><i></i><span class="case">%s</span><time>%s</time></li>',last_detail_feed='<li><i style="top:30px;"></i><span class="case">%s</span><time>%s</time></li>';