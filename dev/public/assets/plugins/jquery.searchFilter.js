jQuery.fn.searchFilter=function(a,b){function c(a,b,c){function d(){return jQuery(this).toggleClass("ui-state-hover"),!1}function e(a){return jQuery(this).toggleClass("ui-state-active","mousedown"==a.type),!1}function f(a,b){return"<option value='"+a+"'>"+b+"</option>"}function g(a,b,c){return"<select class='"+a+"'"+(c?" style='display:none;'":"")+">"+b+"</select>"}function h(b,c){var d=a.find("tr.sf td.data "+b);null!=d[0]&&c(d)}function i(b,c){var d=a.find("tr.sf td.data "+b);null!=d[0]&&jQuery.each(c,function(){null!=this.data?d.bind(this.type,this.data,this.fn):d.bind(this.type,this.fn)})}if(this.$=a,this.add=function(b){return null==b?a.find(".ui-add-last").click():a.find(".sf:eq("+b+") .ui-add").click(),this},this.del=function(b){return null==b?a.find(".sf:last .ui-del").click():a.find(".sf:eq("+b+") .ui-del").click(),this},this.search=function(){return a.find(".ui-search").click(),this},this.reset=function(b){return void 0===b&&(b=!1),a.find(".ui-reset").trigger("click",[b]),this},this.close=function(){return a.find(".ui-closer").click(),this},null!=b){var j=jQuery.extend({},jQuery.fn.searchFilter.defaults,c),k=-1,l="";jQuery.each(j.groupOps,function(){l+=f(this.op,this.text)}),l="<select name='groupOp'>"+l+"</select>",a.html("").addClass("ui-searchFilter").append("<div class='ui-widget-overlay' style='z-index: -1'>&#160;</div><table class='ui-widget-content ui-corner-all'><thead><tr><td colspan='5' class='ui-widget-header ui-corner-all' style='line-height: 18px;'><div class='ui-closer ui-state-default ui-corner-all ui-helper-clearfix' style='float: right;'><span class='ui-icon ui-icon-close'></span></div>"+j.windowTitle+"</td></tr></thead><tbody><tr class='sf'><td class='fields'></td><td class='ops'></td><td class='data'></td><td><div class='ui-del ui-state-default ui-corner-all'><span class='ui-icon ui-icon-minus'></span></div></td><td><div class='ui-add ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plus'></span></div></td></tr><tr><td colspan='5' class='divider'><hr class='ui-widget-content' style='margin:1px'/></td></tr></tbody><tfoot><tr><td colspan='3'><span class='ui-reset ui-state-default ui-corner-all' style='display: inline-block; float: left;'><span class='ui-icon ui-icon-arrowreturnthick-1-w' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+j.resetText+"</span></span><span class='ui-search ui-state-default ui-corner-all' style='display: inline-block; float: right;'><span class='ui-icon ui-icon-search' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+j.searchText+"</span></span><span class='matchText'>"+j.matchText+"</span> "+l+" <span class='rulesText'>"+j.rulesText+"</span></td><td>&#160;</td><td><div class='ui-add-last ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plusthick'></span></div></td></tr></tfoot></table>");var m=a.find("tr.sf"),n=m.find("td.fields"),o=m.find("td.ops"),p=m.find("td.data"),q="";jQuery.each(j.operators,function(){q+=f(this.op,this.text)}),q=g("default",q,!0),o.append(q);var r="<input type='text' class='default' style='display:none;' />";p.append(r);var s="",t=!1,u=!1;jQuery.each(b,function(b){var c=b;if(s+=f(this.itemval,this.text),null!=this.ops){t=!0;var d="";jQuery.each(this.ops,function(){d+=f(this.op,this.text)}),d=g("field"+c,d,!0),o.append(d)}if(null!=this.dataUrl){b>k&&(k=b),u=!0;var e=this.dataEvents,l=this.dataInit,m=this.buildSelect;jQuery.ajax(jQuery.extend({url:this.dataUrl,complete:function(d){var f;f=jQuery("<div />").append(null!=m?m(d):d.responseText),f.find("select").addClass("field"+c).hide(),p.append(f.html()),l&&h(".field"+b,l),e&&i(".field"+b,e),b==k&&a.find("tr.sf td.fields select[name='field']").change()}},j.ajaxSelectOptions))}else if(null!=this.dataValues){u=!0;var n="";jQuery.each(this.dataValues,function(){n+=f(this.value,this.text)}),n=g("field"+c,n,!0),p.append(n)}else if(null!=this.dataEvents||null!=this.dataInit){u=!0;var n="<input type='text' class='field"+c+"' />";p.append(n)}null!=this.dataInit&&b!=k&&h(".field"+b,this.dataInit),null!=this.dataEvents&&b!=k&&i(".field"+b,this.dataEvents)}),s="<select name='field'>"+s+"</select>",n.append(s);var v=n.find("select[name='field']");t?v.change(function(a){var b=a.target.selectedIndex,c=jQuery(a.target).parents("tr.sf").find("td.ops");c.find("select").removeAttr("name").hide();var d=c.find(".field"+b);return null==d[0]&&(d=c.find(".default")),d.attr("name","op").show(),!1}):o.find(".default").attr("name","op").show(),u?v.change(function(a){var b=a.target.selectedIndex,c=jQuery(a.target).parents("tr.sf").find("td.data");c.find("select,input").removeClass("vdata").hide();var d=c.find(".field"+b);return null==d[0]&&(d=c.find(".default")),d.show().addClass("vdata"),!1}):p.find(".default").show().addClass("vdata"),(t||u)&&v.change(),a.find(".ui-state-default").hover(d,d).mousedown(e).mouseup(e),a.find(".ui-closer").click(function(){return j.onClose(jQuery(a.selector)),!1}),a.find(".ui-del").click(function(a){var b=jQuery(a.target).parents(".sf");return b.siblings(".sf").length>0?(j.datepickerFix===!0&&void 0!==jQuery.fn.datepicker&&b.find(".hasDatepicker").datepicker("destroy"),b.remove()):(b.find("select[name='field']")[0].selectedIndex=0,b.find("select[name='op']")[0].selectedIndex=0,b.find(".data input").val(""),b.find(".data select").each(function(){this.selectedIndex=0}),b.find("select[name='field']").change(function(a){a.stopPropagation()})),!1}),a.find(".ui-add").click(function(a){var b=jQuery(a.target).parents(".sf"),c=b.clone(!0).insertAfter(b);if(c.find(".ui-state-default").removeClass("ui-state-hover ui-state-active"),j.clone){c.find("select[name='field']")[0].selectedIndex=b.find("select[name='field']")[0].selectedIndex;var d=null==c.find("select[name='op']")[0];d||(c.find("select[name='op']").focus()[0].selectedIndex=b.find("select[name='op']")[0].selectedIndex);var e=c.find("select.vdata");null!=e[0]&&(e[0].selectedIndex=b.find("select.vdata")[0].selectedIndex)}else c.find(".data input").val(""),c.find("select[name='field']").focus();return j.datepickerFix===!0&&void 0!==jQuery.fn.datepicker&&b.find(".hasDatepicker").each(function(){var a=jQuery.data(this,"datepicker").settings;c.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(a)}),c.find("select[name='field']").change(function(a){a.stopPropagation()}),!1}),a.find(".ui-search").click(function(){var b,c=jQuery(a.selector),d=c.find("select[name='groupOp'] :selected").val();return b=j.stringResult?'{"groupOp":"'+d+'","rules":[':{groupOp:d,rules:[]},c.find(".sf").each(function(a){var c=jQuery(this).find("select[name='field'] :selected").val(),d=jQuery(this).find("select[name='op'] :selected").val(),e=jQuery(this).find("input.vdata,select.vdata :selected").val();e+="",j.stringResult?(e=e.replace(/\\/g,"\\\\").replace(/\"/g,'\\"'),a>0&&(b+=","),b+='{"field":"'+c+'",',b+='"op":"'+d+'",',b+='"data":"'+e+'"}'):b.rules.push({field:c,op:d,data:e})}),j.stringResult&&(b+="]}"),j.onSearch(b),!1}),a.find(".ui-reset").click(function(b,c){var d=jQuery(a.selector);return d.find(".ui-del").click(),d.find("select[name='groupOp']")[0].selectedIndex=0,j.onReset(c),!1}),a.find(".ui-add-last").click(function(){var b=jQuery(a.selector+" .sf:last"),c=b.clone(!0).insertAfter(b);return c.find(".ui-state-default").removeClass("ui-state-hover ui-state-active"),c.find(".data input").val(""),c.find("select[name='field']").focus(),j.datepickerFix===!0&&void 0!==jQuery.fn.datepicker&&b.find(".hasDatepicker").each(function(){var a=jQuery.data(this,"datepicker").settings;c.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(a)}),c.find("select[name='field']").change(function(a){a.stopPropagation()}),!1}),this.setGroupOp=function(b){selDOMobj=a.find("select[name='groupOp']")[0];var c,d={},e=selDOMobj.options.length;for(c=0;e>c;c++)d[selDOMobj.options[c].value]=c;selDOMobj.selectedIndex=d[b],jQuery(selDOMobj).change(function(a){a.stopPropagation()})},this.setFilter=function(a){var b,d,e,f,g,h=a.sfref,i=a.filter,j=[],k={};for(selDOMobj=h.find("select[name='field']")[0],b=0,e=selDOMobj.options.length;e>b;b++)k[selDOMobj.options[b].value]={index:b,ops:{}},j.push(selDOMobj.options[b].value);for(b=0,g=j.length;g>b;b++){if(selDOMobj=h.find(".ops > select[class='field"+b+"']")[0])for(d=0,f=selDOMobj.options.length;f>d;d++)k[j[b]].ops[selDOMobj.options[d].value]=d;if(selDOMobj=h.find(".data > select[class='field"+b+"']")[0])for(k[j[b]].data={},d=0,f=selDOMobj.options.length;f>d;d++)k[j[b]].data[selDOMobj.options[d].value]=d}var l,m,n,o,p;if(l=i.field,k[l]&&(m=k[l].index),null!=m){if(n=k[l].ops[i.op],void 0===n)for(b=0,g=c.operators.length;g>b;b++)if(c.operators[b].op==i.op){n=b;break}o=i.data,p=null==k[l].data?-1:k[l].data[o]}return null!=m&&null!=n&&null!=p?(h.find("select[name='field']")[0].selectedIndex=m,h.find("select[name='field']").change(),h.find("select[name='op']")[0].selectedIndex=n,h.find("input.vdata").val(o),h=h.find("select.vdata")[0],h&&(h.selectedIndex=p),!0):!1}}}return new c(this,a,b)},jQuery.fn.searchFilter.version="1.2.9",jQuery.fn.searchFilter.defaults={clone:!0,datepickerFix:!0,onReset:function(a){alert("Reset Clicked. Data Returned: "+a)},onSearch:function(a){alert("Search Clicked. Data Returned: "+a)},onClose:function(a){a.hide()},groupOps:[{op:"AND",text:"all"},{op:"OR",text:"any"}],operators:[{op:"eq",text:"is equal to"},{op:"ne",text:"is not equal to"},{op:"lt",text:"is less than"},{op:"le",text:"is less or equal to"},{op:"gt",text:"is greater than"},{op:"ge",text:"is greater or equal to"},{op:"in",text:"is in"},{op:"ni",text:"is not in"},{op:"bw",text:"begins with"},{op:"bn",text:"does not begin with"},{op:"ew",text:"ends with"},{op:"en",text:"does not end with"},{op:"cn",text:"contains"},{op:"nc",text:"does not contain"}],matchText:"match",rulesText:"rules",resetText:"Reset",searchText:"Search",stringResult:!0,windowTitle:"Search Rules",ajaxSelectOptions:{}};