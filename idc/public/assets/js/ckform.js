var __check_form_last_error_info=[],check_form=function(formname,opt){function docheck(el,jscheckrule){for(var jscheckrule=jscheckrule||el.attr("jscheckrule"),e_rules=jscheckrule.split(";"),e_rule,e_rules_len=e_rules.length,k=0;e_rules_len>k;k++){var rule_index=e_rules[k].indexOf("=");if(rule_index>-1&&(e_rule=[e_rules[k].substr(0,rule_index),e_rules[k].substr(rule_index+1)],2==e_rule.length)){var cf_func="cf_"+e_rule[0]+"(el,e_rule[1])";try{if(!eval(cf_func))return!1}catch(e){return!1}}}return!0}function strLen(a){var b,c,d,e,f;for(c=a,f=0,b=1;b<=c.length;b++)d=c.substring(b-1,b),e=escape(d),f+=e.length>3?2:1;return f}function cf_trim(a,b){if(1==b){var c=a.val();c=$.trim(c);try{a.val(c)}catch(d){}}return!0}function cf_null(a,b){if(1==b)return!0;var c,d=a.attr("type");if("checkbox"==d||"radio"==d){var e=a.attr("name");c=formobj.filter(":"+d+"[name="+e+"][checked]").map(function(){return this.value}).get().join(",")}else c=a.val();return c=c&&"object"==typeof c?c.join(","):c,0==b&&(c=$.trim(c)),1==b||""!=c?!0:(a.data("jscheckerror","不能为空"),!1)}function cf_maxlen(a,b){var c=a.val();return""==c||strLen(c)<=b?!0:(a.data("jscheckerror","长度不能大于 "+b+" 字节"),!1)}function cf_minlen(a,b){var c=a.val();return""==c||strLen(c)>=b?!0:(a.data("jscheckerror","长度不能小于 "+b+" 字节"),!1)}function cf_maxnum(a,b){var c=a.val();return 1*b>=1*c?!0:(a.data("jscheckerror","不能大于 "+b),!1)}function cf_maxlencn(a,b){var c=a.val();return""==c||c.length<=b?!0:(a.data("jscheckerror","字数不能大于 "+b+" 字"),!1)}function cf_minlencn(a,b){var c=a.val();return""==c||c.length>=b?!0:(a.data("jscheckerror","字数不能小于 "+b+" 字"),!1)}function cf_lencn(a,b){var c=a.val();return""==c||c.length==b?!0:void a.data("jscheckerror","字数必须等于 "+b+" 字")}function cf_minnum(a,b){var c=a.val();return""==c||1*c>=1*b?!0:(a.data("jscheckerror","不能小于 "+b),!1)}function cf_len(a,b){var c=a.val();return""==c||strLen(c)==b?!0:void a.data("jscheckerror","长度必须等于 "+b+" 字节")}function cf_email(a,b){var c=a.val();return""!=c&&b?(rx="^([\\w\\_\\.])+@([\\w]+\\.)+([\\w])+$",cf_regexp(a,rx)?!0:(a.data("jscheckerror","必须为 EMAIL 格式"),!1)):!0}function cf_sameto(a,b){var c=a.val();return""==c||c==formobj.filter("#"+b).val()?!0:(b=formobj.filter("#"+b).attr("jschecktitle")||b,a.data("jscheckerror","必须等于 "+b+" 的值"),!1)}function cf_differentto(a,b){var c=a.val();return""==c||c==formobj.filter("#"+e1).val()?!0:(a.data("jscheckerror","必须不等于 "+b+" 的值"),!1)}function cf_nosame(a,b){var c=a.val();if(""==c)return!0;for(var d=b.split(","),e=d.length,f=0;e>f;f++)if(d[f]==c)return a.data("jscheckerror","不能等于 "+b.join(" 或 ")),!1;return!0}function cf_charset(a,b){var c=a.val();if(""==c)return!0;for(var d="",e=b.split(","),f=e.length,g=[],h=0;f>h;h++)"en"==e[h]?(d+="a-zA-Z",g[h]="字母"):"num"==e[h]?(d+="0-9",g[h]="数字"):"fl"==e[h]?(d+="0-9\\.0-9",g[h]="小数"):"cn"==e[h]?(d+="\\u4E00-\\u9FA5",g[h]="中文"):"ul"==e[h]&&(d+="_",g[h]="下划线");if(""==d)return!0;var i="^["+d+"]*$";return cf_regexp(a,i)?!0:(a.data("jscheckerror","必须为["+g.join(",")+"]"),!1)}function cf_regexp(a,b){var c=a.val();if(""==c)return!0;if(""==b)return!0;var d=new RegExp(b,"ig");return d.test(c)?!0:(a.data("jscheckerror","含有非法字符"),!1)}function cf_html(a,b){var c=a.val();return""==c||null==c?!0:1==b?!0:-1==c.indexOf("<")&&-1==c.indexOf(">")?!0:(a.data("jscheckerror","含有html字符"),!1)}function cf_ajax(a,b){return _temp_ajax=_temp_ajax.concat({obj:a,str:b}),!0}function _cf_ajax(obj,str){var str_obj=eval("("+str+")"),resp=$.ajax({url:str_obj.url,async:!1,data:str_obj.data}).responseText;return"true"===resp?!0:(obj.data("jscheckerror",resp),!1)}function get_param(str){return eval("("+str+")")}function cf_call(a,b){var c=get_param.call(a.get(0),b);for(var d in c){var e=window[d].apply(void 0,c[d]);if(e!==!0)return a.data("jscheckerror",e),!1}return!0}var formobj,e_error="",focus_obj="",error=[],_temp_ajax=new Array,opt=opt||{};if(opt=$.extend({type:"form",trim:!0,errtype:0,showtype:0},opt),"elem"==opt.type?(formobj=$(formname),formname=$("body")):formobj=$("input,textarea,select,button",formname),formobj.each(function(){var a=$(this),b=a.attr("jscheckflag"),c=a.attr("tagName");if(b=void 0==b?1:b,0==b)return!0;var d=a.attr("jscheckrule")||"",e=a.attr("jscheckerror"),f=a.attr("jschecktitle")||"表单",g=a.attr("maxLength");-1==d.indexOf("trim=0")&&opt.trim&&cf_trim(a,1),-1==d.indexOf("html=")&&(d+=";html=0");var h=a.val(),i=0;"TEXTAREA"==c&&(g>0&&h.length>g?1:0)?(e=(f?f:a.attr("name"))+" 不得超过 "+g+" 字",i=1):d&&(i=docheck(a,d)?i:1),i?(e_error=e?e:f+" "+a.data("jscheckerror"),error.push(e_error),""==focus_obj&&(focus_obj=a),void 0==this.oldback&&(this.oldback=this.style.backgroundColor),this.style.backgroundColor="#FFFF00"):void 0!=this.oldback&&(this.style.backgroundColor=this.oldback)}),!error)for(var i in _temp_ajax){var obj=_temp_ajax[i].obj,str=_temp_ajax[i].str,jscheckerror=obj.attr("jscheckerror"),jschecktitle=obj.attr("jschecktitle");if(1!=_cf_ajax.call(obj.get(0),obj,str)){e_error=jscheckerror?jscheckerror:jschecktitle+" "+obj.data("jscheckerror"),error.push(e_error),""==focus_obj&&(focus_obj=obj),void 0==obj.get(0).oldback&&(obj.get(0).oldback=obj.get(0).style.backgroundColor),obj.get(0).style.backgroundColor="#FFFF00";break}}if(error.length>0){__check_form_last_error_info=error,0==opt.showtype&&alert("表单存在以下错误:\n"+error.join("\n"));try{focus_obj.focus()}catch(e){}return!1}return!0};check_form.get_error=function(){return __check_form_last_error_info};