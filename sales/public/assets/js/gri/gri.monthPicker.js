GRI=window.GRI||{},GRI.monthPicker={_conf:{startYear:1970,endYear:(new Date).getFullYear(),cols:4,rows:3,container:"gri_monthPicker_wrapper",calendar:"gri_monthPicker_panel",dataTable:"gri_monthPicker_table",containerCss:"ta_calendar cf",selectCss:"current",contentCss:"ta_calendar_cont cf",tableCss:"calendar-month",disabledCss:"ta_dateRangeGray",input:{},id:"month_picker",trigger:"month_trigger",callback:function(){return!0},autoCommit:!1,returnDate:!1,defaultMonth:"",lastMonth:!1,period:!1,start_month:"",end_month:"",defaultText:" 至 "},assemble:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1},create:function(a,b){var c=this;if(c._conf.id=a,c._conf=$.extend(!0,c._conf,b),$("#"+a).length>0&&function(){$("#"+a).bind("click",function(){c.show(c.util.$(a))})}(),$("#"+c._conf.trigger).length>0&&function(){$("#"+c._conf.trigger).bind("click",function(){c.show(c.util.$(a))})}(),c._conf.period&&""!=c._conf.start_month&&""!=c._conf.end_month)$("#"+a).html(c._conf.start_month+c._conf.defaultText+c._conf.end_month),c._conf.autoCommit&&c._conf.callback({start_date:c._conf.start_month+"-01",end_date:c._conf.end_month+"-31"});else{this._conf.lastMonth&&(this.assemble.month=(new Date).getMonth()),""!==this._conf.defaultMonth&&(this.assemble={year:this._conf.defaultMonth.substr(0,4),month:1*this._conf.defaultMonth.substr(4)});var d=this.util.format(this.assemble);$("#"+a).html(d.year+"-"+d.month),c._conf.autoCommit&&c._conf.callback(c.convertToDate(this.util.format(this.assemble)))}$(document).bind("click",function(a){c.cancel(a)})},getCurrentShowDate:function(){var a=this,b="";return $("#"+a._conf.id).length>0?(b=$("#"+a._conf.id).html(),{year:b.split("-")[0],month:b.split("-")[1]}):void 0},convertToDate:function(a){return this._conf.returnDate?{start_date:a.year+"-"+a.month+"-01",end_date:a.year+"-"+a.month+"-31"}:a.year+"-"+a.month},show:function(a){if(this._conf.input=a,this.util.$(this._conf.container)){var b=$("#"+this._conf.id).offset(),c=$("#"+this._conf.id).attr("offsetHeight");return this.util.$(this._conf.container).style.display="block",this.util.$(this._conf.container).style.top=b.top+(c?c-1:32)+"px",this.util.$(this._conf.container).style.left=b.left+"px",!1}var d=this.util.creatEle("div");d.setAttribute("id",this._conf.container),$(d).addClass(this._conf.containerCss),d.style.zIndex="9999";var b=$("#"+this._conf.id).offset(),c=$("#"+this._conf.id).attr("offsetHeight");d.style.top=b.top+(c?c-1:32)+"px",d.style.left=b.left+"px",document.body.appendChild(d);var e=this.util.creatEle("div");e.id=this._conf.calendar,$(e).addClass(this._conf.contentCss);var f=[];f.push('<i class="i_pre" style="z-index:1" id="gri_preYear"></i>'),f.push('<i class="i_next" style="z-index:1" id="gri_nextYear"></i>'),$(e).append(f.join("")),d.appendChild(e),d.style.display="block",this.init()},init:function(){var a=this,b=panel=[],c=this.util.creatEle("table");$(c).addClass(this._conf.tableCss);var d=document.createElement("caption"),e=document.createElement("span");e.id="gri_year",$(e).append(this._conf.endYear+"年"),$(d).append(e),$(c).append(d);{var f=this.util.creatEle("tbody");this.util.creatEle("tr"),this.util.creatEle("td")}return f.setAttribute("id",this._conf.dataTable),c.appendChild(f),$(0<$("#"+this._conf.calendar).length?"#"+this._conf.calendar:document.body).append(c),this.construct(),b=[],$("#gri_preYear").click(function(){a.preYear(a.reset)}),$("#gri_nextYear").click(function(){a.nextYear(a.reset)}),this.reset(this),c},construct:function(){that=this,$("#"+this._conf.dataTable).html("");var a={data:{1:[1,2,3,4],2:[5,6,7,8],3:[9,10,11,12]},typical:{1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七",8:"八",9:"九",10:"十",11:"十一",12:"十二"},special:{}};for(var b in a.data){for(var c=this.util.creatEle("tr"),d=0;d<a.data[b].length;d++){var e=this.util.creatEle("td");e.innerHTML=a.typical[a.data[b][d]]+"月",e.setAttribute("id","gri_month"+a.data[b][d]),this.assemble.year==this.util.getCurrentDate().year&&a.data[b][d]>this.util.getCurrentDate().month?$(e).addClass(this._conf.disabledCss):this._conf.period?window.addEventListener&&e.addEventListener("click",this.hdlPeriod,!1)||window.attachEvent&&e.attachEvent("onclick",this.hdlPeriod):window.addEventListener&&e.addEventListener("click",this.addCss,!1)||window.attachEvent&&e.attachEvent("onclick",this.addCss),c.appendChild(e)}$("#"+this._conf.dataTable).append(c)}},preYear:function(a){this.assemble.year=1*this.assemble.year-1,this.util.$("gri_year").innerHTML=this.assemble.year+"年",a&&a(this)},nextYear:function(a){this.assemble.year=1*this.assemble.year+1,this.util.$("gri_year").innerHTML=this.assemble.year+"年",a&&a(this)},hdlPeriod:function(a){var a=window.event||a,b=a.srcElement||a.target,c=/^gri_month(\d+)/.test(b.getAttribute("id"))&&/^gri_month(\d+)/.exec(b.getAttribute("id"))[1],d=end={};if(that.removeCss(),GRI.monthPicker.Params.current=""==GRI.monthPicker.Params.current||GRI.monthPicker.Params.current==GRI.monthPicker.Constant.END_MONTH?GRI.monthPicker.Constant.START_MONTH:GRI.monthPicker.Constant.END_MONTH,GRI.monthPicker.Params.current==GRI.monthPicker.Constant.START_MONTH)$(b).addClass(that._conf.selectCss),GRI.monthPicker.Params.start_month=c,GRI.monthPicker.Params.start_year=that.assemble.year;else{GRI.monthPicker.Params.end_month=c,GRI.monthPicker.Params.end_year=that.assemble.year,sm=Math.min(GRI.monthPicker.Params.end_month,GRI.monthPicker.Params.start_month),em=Math.max(GRI.monthPicker.Params.end_month,GRI.monthPicker.Params.start_month);for(var e=sm;em>=e;e++)$("#gri_month"+e).addClass(that._conf.selectCss);if(d=that.util.format({year:GRI.monthPicker.Params.start_year,month:GRI.monthPicker.Params.start_month}),end=that.util.format({year:GRI.monthPicker.Params.end_year,month:GRI.monthPicker.Params.end_month}),1*GRI.monthPicker.Params.start_year>1*GRI.monthPicker.Params.end_year||1*GRI.monthPicker.Params.start_year<=1*GRI.monthPicker.Params.end_year&&1*GRI.monthPicker.Params.start_month>1*GRI.monthPicker.Params.end_month){var f=d;d=end,end=f}that._conf.input.innerHTML=[d.year,d.month].join("-")+that._conf.defaultText+[end.year,end.month].join("-"),that._conf.callback({start_date:d.year+"-"+d.month+"-01",end_date:end.year+"-"+end.month+"-31"})}},addCss:function(a){that.removeCss();var a=window.event||a,b=a.srcElement||a.target;$(b).addClass(that._conf.selectCss),that.assemble.month=/^gri_month(\d+)/.test(b.getAttribute("id"))&&/^gri_month(\d+)/.exec(b.getAttribute("id"))[1],that.submit()},removeCss:function(){var a=/^gri_month(\d+)/,b=$("#gri_monthPicker_table").find("td");for(var c in b)b[c].id&&a.test(b[c].id)&&($(b[c]).removeClass(this._conf.selectCsss).removeClass(this._conf.disabledCss),this.assemble.year==this.util.getCurrentDate().year&&b[c].id.match(a)[1]>this.util.getCurrentDate().month&&$(b[c]).addClass(this._conf.disabledCss))},cancel:function(a){var a=window.event||a,b=a.srcElement||a.target;!(b.id&&(b.id==this._conf.id||b.id==this._conf.trigger)||this._conf.period&&GRI.monthPicker.Params.current==GRI.monthPicker.Constant.START_MONTH||b.className&&("i_pre"==b.className||"i_next"==b.className))&&$("#"+this._conf.container).length>0&&$("#"+this._conf.container).hide()},submit:function(){var a=[];fd=this.util.format(this.assemble);for(var b in fd)a.push(fd[b]);this.util.$(this._conf.container).style.display="none",this._conf.input.innerHTML=a.join("-"),this._conf.callback(this.convertToDate(this.util.format(this.assemble)))},reset:function(a){a.construct(),a.util.$("gri_nextYear").style.display=a.assemble.year>=a._conf.endYear?"none":"block",a.util.$("gri_preYear").style.display=a.assemble.year<=a._conf.startYear?"none":"block";var b=a.getCurrentShowDate();a.util.format(a.assemble).year==b.year&&a.util.format(a.assemble).month==b.month&&$("#gri_month"+a.assemble.month).addClass(a._conf.selectCss)},util:{$:function(a){return document.getElementById(a)},creatEle:function(a){return document.createElement(a)},addEvt:function(a,b,c){var d=function(a){var a=window.event||a,b=a.srcElement||a.target;c(a,b)};window.addEventListener&&a.addEventListener(b,d,!1)||window.attachEvent&&a.attachEvent("on"+b,d)},getCurrentDate:function(){return{year:(new Date).getFullYear(),month:(new Date).getMonth()+1}},getCla:function(){return window.attachEvent&&-1===navigator.userAgent.indexOf("Opera")?"class":"class"},format:function(a){return{year:a.year,month:(a.month<10?"0":"")+a.month}}}},GRI.monthPicker.Constant={START_MONTH:"start_month",END_MONTH:"end_month"},GRI.monthPicker.Params={current:"",start_year:"",start_month:"",end_month:"",end_year:""};