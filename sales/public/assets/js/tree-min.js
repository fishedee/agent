define("bui/tree",["bui/common","bui/tree/treemixin","bui/tree/treelist"],function(a){var b=a("bui/common"),c=b.namespace("Tree");return b.mix(c,{TreeList:a("bui/tree/treelist"),Mixin:a("bui/tree/treemixin")}),c}),define("bui/tree/treemixin",["bui/common","bui/data"],function(a){function b(a,b){return c.isString(b)&&(b=a.getItem(b)),b}var c=a("bui/common"),d=a("bui/data"),e="expanded",f="loading",g="checked",h="partial-checked",i={NONE:"none",ALL:"all",CUSTOM:"custom",ONLY_LEAF:"onlyLeaf"},j="x-tree-icon",k="x-tree-elbow",l="x-tree-show-line",m=k+"-",n=j+"-wraper",o=m+"line",p=m+"end",q=m+"empty",r=m+"expander",s=j+"-checkbox",t=r+"-end",u=function(){};return u.ATTRS={store:{getter:function(a){if(!a){var b=this,c=new d.TreeStore({root:b.get("root"),data:b.get("nodes")});return b.setInternal("store",c),c}return a}},root:{},nodes:{sync:!1},iconContainer:{},iconWraperTpl:{value:'<span class="'+n+'">{icons}</span>'},showLine:{value:!1},iconTpl:{value:'<span class="x-tree-icon {cls}"></span>'},leafCls:{value:m+"leaf"},dirCls:{value:m+"dir"},checkType:{value:"custom"},checkedField:{valueFn:function(){return this.getStatusField("checked")}},itemStatusFields:{value:{expanded:"expanded",disabled:"disabled",checked:"checked"}},dirSelectable:{value:!0},showRoot:{value:!1},events:{value:{expanded:!1,collapsed:!1,checkchange:!1}},startLevel:{value:1}},c.augment(u,{collapseAll:function(){var a=this,b=a.get("view").getAllElements();c.each(b,function(b){var c=a.getItemByElement(b);c&&a._collapseNode(c,b,!0)})},collapseNode:function(a){var b,d=this;c.isString(a)&&(a=d.findNode(a)),b=d.findElement(a),d._collapseNode(a,b)},expandAll:function(){var a=this,b=a.get("view").getAllElements();c.each(b,function(b){var c=a.getItemByElement(b);a._expandNode(c,b,!0)})},expandNode:function(a,b){var d,e=this;c.isString(a)&&(a=e.findNode(a)),a.parent&&!e.isExpanded(a.parent)&&e.expandNode(a.parent),d=e.findElement(a),e._expandNode(a,d,b)},expandPath:function(a,b,c){if(a){c=c||0;var d,e,f,g,h=this,i=h.get("store"),j=a.split(",");for(d=h.findNode(j[c]),f=c+1;f<j.length;f++)if(g=j[f],e=h.findNode(g,d),d&&e)h.expandNode(d),d=e;else if(d&&b){i.load({id:d.id},function(){e=h.findNode(g,d),e&&h.expandPath(a,b,f)});break}}},findNode:function(a,b){return this.get("store").findNode(a,b)},getCheckedLeaf:function(a){var b=this,c=b.get("store");return c.findNodesBy(function(a){return a.leaf&&b.isChecked(a)},a)},getCheckedNodes:function(a){var b=this,c=b.get("store");return c.findNodesBy(function(a){return b.isChecked(a)},a)},isExpanded:function(a){if(!a||a.leaf)return!1;var b,d=this;return d._isRoot(a)&&!d.get("showRoot")?!0:(c.isString(a)&&(item=d.getItem(a)),b=d.findElement(a),this._isExpanded(a,b))},isChecked:function(a){return a?a[this.get("checkedField")]:!1},toggleExpand:function(a){var b,d=this;c.isString(a)&&(item=d.getItem(a)),b=d.findElement(a),d._toggleExpand(a,b)},setNodeChecked:function(a,d,e){e=null==e?!0:e;var f,h,i=this;a=b(this,a),f=a.parent,i.isCheckable(a)&&((i.isChecked(a)!==d||i.hasStatus(a,"checked")!==d)&&(h=i.findElement(a),h?(i.setItemStatus(a,g,d,h),i._resetPatialChecked(a,d,d,h)):i.isItemDisabled(a)||i.setStatusValue(a,"checked",d),f&&(i.isChecked(f)!=d?i._resetParentChecked(f):i._resetPatialChecked(f,null,null,null,!0)),i.fire("checkchange",{node:a,element:h,checked:d})),!a.leaf&&e&&c.each(a.children,function(a){i.setNodeChecked(a,d,e)}))},_initRoot:function(){var a,b,d=this,e=d.get("store"),f=d.get("showRoot");e&&(a=e.get("root"),d.setInternal("root",a),b=f?[a]:a.children,c.each(b,function(a){d._initChecked(a,!0)}),d.clearItems(),d.addItems(b))},_initChecked:function(a,b){var d,e=this,f=e.get("checkType"),g=e.get("checkedField");return f===i.NONE?void delete a[g]:f===i.ONLY_LEAF?void(a.leaf?a[g]=a[g]||!1:(delete a[g],b&&c.each(a.children,function(a){e._initChecked(a,b)}))):(f===i.ALL&&(a[g]=a[g]||!1),void(a&&e.isCheckable(a)&&(d=a.parent,e.isChecked(a)||(d&&e.isChecked(d)&&e.setStatusValue(a,"checked",!0),e._isAllChildrenChecked(a)&&e.setStatusValue(a,"checked",!0)),b&&c.each(a.children,function(a){e._initChecked(a,b)}))))},_resetPatialChecked:function(a,b,c,d,e){if(!a||a.leaf)return!0;var c,f=this;return(b=null==b?f.isChecked(a):b)?void f.setItemStatus(a,h,!1,d):(c=null==c?f._hasChildChecked(a):c,f.setItemStatus(a,h,c,d),e&&a.parent&&f._resetPatialChecked(a.parent,!1,c?c:null,null,e),void 0)},_resetParentChecked:function(a){if(this.isCheckable(a)){var b=this,c=b._isAllChildrenChecked(a);b.setStatusValue(a,"checked",c),b.setNodeChecked(a,c,!1),b._resetPatialChecked(a,c,null,null)}},__bindUI:function(){{var a=this;a.get("el")}a.on("itemclick",function(b){var c=$(b.domTarget),d=b.element,e=a.get("dirSelectable"),f=b.item;if(c.hasClass(r))a._toggleExpand(f,d);else if(c.hasClass(s)){var g=a.isChecked(f);a.setNodeChecked(f,!g)}return e||f.leaf?void 0:!1}),a.on("itemrendered",function(b){var c=b.item,d=b.domTarget;a._resetIcons(c,d),a.isCheckable(c)&&a._resetPatialChecked(c,null,null,d),a._isExpanded(c,d)&&a._showChildren(c)})},_isAllChildrenChecked:function(a){if(!a||a.leaf)return!1;var b=this,d=a.children,e=!0;return c.each(d,function(a){return e=e&&b.isChecked(a),e?void 0:!1}),e},_hasChildChecked:function(a){if(!a||a.leaf)return!1;var b=this;return 0!=b.getCheckedNodes(a).length},_isRoot:function(a){var b=this,c=b.get("store");return c&&c.get("root")==a?!0:!1},_setLoadStatus:function(a,b,c){var d=this;d.setItemStatus(a,f,c,b)},_beforeLoadNode:function(a){var b,d=this;c.isString(a)&&(a=d.findNode(a)),b=d.findElement(a),b&&d._setLoadStatus(a,b,!0),a&&c.each(a.children,function(a){d._removeNode(a)})},onBeforeLoad:function(a){var b=this,c=a.params,d=c.id,e=b.findNode(d)||b.get("root");b._beforeLoadNode(e)},_addNode:function(a,b){var c,d,e,f=this,g=a.parent;f._initChecked(a,!0),g?(f.isExpanded(g)&&(c=g.children.length,e=f._getInsetIndex(a),f.addItemAt(a,e),b==c-1&&b>0&&(d=g.children[b-1],f._updateIcons(d))),f._updateIcons(g)):(e=f._getInsetIndex(a),f.addItemAt(a,e),d=f.get("nodes")[b-1],f._updateIcons(d))},_getInsetIndex:function(a){var b,c=this;return b=c._getNextItem(a),b?c.indexOfItem(b):c.getItemCount()},_getNextItem:function(a){var b,d,e=this,f=a.parent,g=null;return f?(b=f.children,d=c.Array.indexOf(a,b),g=b[d+1],g||e._getNextItem(f)):null},onAdd:function(a){var b=this,c=a.node,d=a.index;b._addNode(c,d)},_updateNode:function(a){var b=this;b.updateItem(a),b._updateIcons(a)},onUpdate:function(a){var b=this,c=a.node;b._updateNode(c)},_removeNode:function(a,b){var c,d,e=this,f=a.parent;e.collapseNode(a),f&&(e.removeItem(a),e.isExpanded(f)&&(c=f.children.length,c==b&&0!==b&&(d=f.children[b-1],e._updateIcons(d))),e._updateIcons(f),e._resetParentChecked(f))},onRemove:function(a){var b=this,c=a.node,d=a.index;b._removeNode(c,d)},_loadNode:function(a){var b=this;b.expandNode(a),b._updateIcons(a),b.setItemStatus(a,f,!1)},onLoad:function(a){var b=this,c=b.get("store"),d=c.get("root");(!a||a.node==d)&&b._initRoot(),a&&a.node&&b._loadNode(a.node)},_isExpanded:function(a,b){return this.hasStatus(a,e,b)},_getIconsTpl:function(a){var b,d=this,e=a.level,f=d.get("startLevel"),g=d.get("iconWraperTpl"),h=[];for(b=f;e>b;b+=1)h.push(d._getLevelIcon(a,b));return h.push(d._getExpandIcon(a)),h.push(d._getCheckedIcon(a)),h.push(d._getNodeTypeIcon(a)),c.substitute(g,{icons:h.join("")})},_getCheckedIcon:function(a){var b=this,c=b.isCheckable(a);return c?b._getIcon(s):""},isCheckable:function(a){return null!=a[this.get("checkedField")]},_getExpandIcon:function(a){var b=this,c=r;return a.leaf?b._getLevelIcon(a):(b._isLastNode(a)&&(c=c+" "+t),b._getIcon(c))},_getNodeTypeIcon:function(a){var b=this,c=a.cls?a.cls:b.get(a.leaf?"leafCls":"dirCls");return b._getIcon(c)},_getLevelIcon:function(a,b){var c,d=this,e=d.get("showLine"),f=q;return e&&(a.level===b||null==b?f=d._isLastNode(a)?p:k:(c=d._getParentNode(a,b),f=d._isLastNode(c)?q:o)),d._getIcon(f)},_getParentNode:function(a,b){var c=a.level,d=a.parent,e=c-1;if(b>=c)return null;for(;e>b;)d=d.parent,e-=1;return d},_getIcon:function(a){var b=this,d=b.get("iconTpl");return c.substitute(d,{cls:a})},_isLastNode:function(a){if(!a)return!1;if(a==this.get("root"))return!0;var b,c=this,d=a.parent,e=d?d.children:c.get("nodes");return b=e.length,e[b-1]===a},_initNodes:function(a,b,d){var e=this;c.each(a,function(a){a.level=b,null==a.leaf&&(a.leaf=a.children?!1:!0),d&&!a.parent&&(a.parent=d),e._initChecked(a),a.children&&e._initNodes(a.children,b+1,a)})},_collapseNode:function(a,b,c){var d=this;a.leaf||d.hasStatus(a,e,b)&&(d.setItemStatus(a,e,!1,b),c?(d._collapseChildren(a,c),d.removeItems(a.children)):d._hideChildrenNodes(a),d.fire("collapsed",{node:a,element:b}))},_hideChildrenNodes:function(a){var b=this,d=a.children;c.each(d,function(a){b.removeItem(a),b._hideChildrenNodes(a)})},_collapseChildren:function(a,b){var d=this,e=a.children;c.each(e,function(a){d.collapseNode(a,b)})},_expandNode:function(a,b,d){var f=this,g=f.get("store");a.leaf||(f.hasStatus(a,e,b)||(g&&!g.isLoaded(a)?f._isLoading(a,b)||g.loadNode(a):b&&(f.setItemStatus(a,e,!0,b),f._showChildren(a),f.fire("expanded",{node:a,element:b}))),c.each(a.children,function(a){(d||f.isExpanded(a))&&f.expandNode(a,d)}))},_showChildren:function(a){if(a&&a.children){var b,c,d=this,e=d.indexOfItem(a),f=a.children.length;for(c=f-1;c>=0;c--)b=a.children[c],d.getItem(b)||d.addItemAt(b,e+1)}},_isLoading:function(a,b){var c=this;return c.hasStatus(a,f,b)},_resetIcons:function(a,b){var c,d=this,e=d.get("iconContainer"),f=d._getIconsTpl(a);$(b).find("."+n).remove(),c=$(b).find("."+e),e&&c.length?$(f).appendTo(c):$(b).prepend($(f))},_toggleExpand:function(a,b){var c=this;c._isExpanded(a,b)?c._collapseNode(a,b):c._expandNode(a,b)},_updateIcons:function(a){var b=this,d=b.findElement(a);d&&(b._resetIcons(a,d),b._isExpanded(a,d)&&!a.leaf&&c.each(a.children,function(a){b._updateIcons(a)}))},_uiSetShowRoot:function(){var a=this,b=this.get("showRoot")?0:1;a.set("startLevel",b)},_uiSetNodes:function(a){var b=this,c=b.get("store");c.setResult(a)},_uiSetShowLine:function(a){var b=this,c=b.get("el");a?c.addClass(l):c.removeClass(l)}}),u}),define("bui/tree/treelist",["bui/common","bui/list","bui/tree/treemixin"],function(a){var b=a("bui/common"),c=a("bui/list"),d=a("bui/tree/treemixin"),e=c.SimpleList.extend([d],{},{ATTRS:{itemCls:{value:b.prefix+"tree-item"},itemTpl:{value:"<li>{text}</li>"},idField:{value:"id"}}},{xclass:"tree-list"});return e});